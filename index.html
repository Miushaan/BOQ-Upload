<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Salary & OT Tracker</title>
    <style>
        /* Pro UI Styling */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background-color: #e8ebed; color: #333; }
        .header { background-color: #2c3e50; color: white; padding: 20px 0; text-align: center; }
        .header h1 { margin: 0; font-weight: 300; letter-spacing: 1px; }
        .container {
            max-width: 1000px;
            margin: 30px auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 25px;
        }
        .left-panel { flex: 2; min-width: 450px; }
        .right-panel { flex: 1; min-width: 300px; }
        
        /* Calendar Styles */
        .calendar-section, .controls-section { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 20px; background-color: #fcfcfc; }
        h2 { border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 0; color: #2c3e50; font-size: 1.4em; }
        .pay-period-display { color: #e74c3c; font-weight: bold; margin-bottom: 15px; text-align: center; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .calendar-header h3 { margin: 0; color: #2c3e50; font-size: 1.2em; }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
        }
        .day-name { background-color: #34495e; color: white; font-weight: 600; padding: 8px 0; font-size: 0.9em; }
        .day-cell {
            padding: 10px 5px;
            border: 1px solid #eee;
            cursor: pointer;
            position: relative;
            transition: background-color 0.1s;
        }
        .day-cell.current-month { background-color: #fff; color: #333; }
        .day-cell:not(.current-month) { background-color: #f9f9f9; color: #aaa; pointer-events: none; }
        .day-cell.selected { background-color: #3498db !important; color: white; border-color: #2980b9; }
        .day-cell:hover:not(.selected) { background-color: #eef; }
        .ot-indicator {
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.6em;
            color: #e74c3c;
            font-weight: bold;
        }

        /* OT Input Form & Presets */
        .ot-form { padding: 15px; border-top: 1px solid #ddd; margin-top: 15px; background-color: #f7f9fb; border-radius: 4px; }
        .ot-form-title { font-size: 1.1em; font-weight: 600; margin-bottom: 10px; color: #2980b9; }
        .input-group { margin-bottom: 10px; }
        label { display: block; margin-bottom: 4px; font-weight: 500; font-size: 0.9em; }
        input[type="number"] { padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 0.9em; }
        
        .preset-buttons { margin-bottom: 15px; }
        .preset-buttons button {
            padding: 5px 10px;
            margin-right: 5px;
            background-color: #f39c12;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            margin-top: 5px;
            transition: background-color 0.2s;
        }
        .preset-buttons button.double { background-color: #e74c3c; }
        .preset-buttons button:hover { background-color: #d35400; }

        button.calculate-btn { 
            padding: 10px; 
            background-color: #2ecc71; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 0.9em; 
            margin-top: 10px; 
            transition: background-color 0.2s; 
            width: 100%;
        }
        button.calculate-btn:hover { background-color: #27ae60; }
        
        /* Results/Summary Styles */
        .results-section { background-color: #ecf0f1; padding: 20px; border-radius: 8px; margin-top: 20px; }
        .result-detail { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #c0c0c0; font-size: 1em; }
        .result-detail strong { font-weight: 600; }
        .result-summary { padding-top: 15px; margin-top: 15px; border-top: 2px solid #bdc3c7; }
        #gross-salary { font-size: 2.2em; color: #27ae60; font-weight: bold; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üíµ Professional Salary & OT Tracker</h1>
    </div>
    <div class="container">
        
        <div class="left-panel">
            <div class="calendar-section">
                <h2>üóìÔ∏è Pay Period Tracker</h2>
                <div id="pay-period-display" class="pay-period-display"></div>
                <div class="calendar-header">
                    <button onclick="changeMonth(-1)">&#9664; Prev Month</button>
                    <h3 id="current-month-year"></h3>
                    <button onclick="changeMonth(1)">Next Month &#9654;</button>
                </div>
                <div class="calendar-grid" id="calendar-grid">
                    </div>
            </div>

            <div class="ot-form">
                <div class="ot-form-title" id="ot-form-title">Enter OT for: Please Select a Date</div>

                <div class="preset-buttons">
                    <p style="font-size: 0.9em; font-weight: 600; margin-bottom: 5px;">Presets (Click to Apply):</p>
                    <button onclick="setPresetOT('normal', 2.15)">Normal 2.15</button>
                    <button onclick="setPresetOT('normal', 3.45)">Normal 3.45</button>
                    <button onclick="setPresetOT('normal', 5.45)">Normal 5.45</button>
                    <button class="double" onclick="setPresetOT('double', 8.00)">Double 8.00</button>
                </div>

                <div class="input-group">
                    <label for="dailyNormalOt">Normal OT Hours (H.MM format):</label>
                    <input type="number" id="dailyNormalOt" value="0.00" min="0" step="0.01" onchange="saveDailyOT()" onkeydown="if(event.keyCode == 13) saveDailyOT()">
                </div>
                <div class="input-group">
                    <label for="dailyDoubleOt">Double OT Hours (H.MM format):</label>
                    <input type="number" id="dailyDoubleOt" value="0.00" min="0" step="0.01" onchange="saveDailyOT()" onkeydown="if(event.keyCode == 13) saveDailyOT()">
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="controls-section">
                <h2>‚ûï Monthly Bonuses</h2>
                <div class="input-group">
                    <label for="sixthDaysWorked">Sixth Days Worked:</label>
                    <input type="number" id="sixthDaysWorked" value="0" min="0" onchange="calculateSalary(); saveDataToLocalStorage()">
                </div>
                <div class="input-group">
                    <label for="extraDaysWorked">Extra Days Worked:</label>
                    <input type="number" id="extraDaysWorked" value="0" min="0" onchange="calculateSalary(); saveDataToLocalStorage()">
                </div>
                <div class="input-group">
                    <label for="attendanceDays">Attendance Days (for Bonus):</label>
                    <input type="number" id="attendanceDays" value="0" min="0" onchange="calculateSalary(); saveDataToLocalStorage()">
                </div>
            </div>

            <button class="calculate-btn" onclick="calculateSalary(); saveDataToLocalStorage()">Calculate Full Salary</button>

            <div class="results-section">
                <h2>Summary & Breakdown</h2>
                <div id="ot-summary"></div>
                <div id="bonus-summary"></div>
                
                <div class="result-summary">
                    <div id="details"></div>
                </div>

                <div class="result-summary">
                    <p><strong>Total Gross Salary (Including Basic Pay):</strong></p>
                    <div id="gross-salary">0.00</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Payroll Constants
        const BASIC_SALARY = 15290.00;
        const NORMAL_OT_RATE = 52.03;
        const DOUBLE_OT_RATE = 62.44;
        const SIXTH_DAY_BONUS = 374.63;
        const EXTRA_DAY_RATE = 166.50;
        const ATTENDANCE_BONUS_RATE = 75.00;
        const STORAGE_KEY = 'SalaryTrackerData'; // Key for Local Storage

        
        // Global State
        let otData = {}; 
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let selectedDate = null;

        // --- LOCAL STORAGE FUNCTIONS ---

        function saveDataToLocalStorage() {
            const data = {
                otData: otData,
                currentMonth: currentMonth,
                currentYear: currentYear,
                sixthDaysWorked: document.getElementById('sixthDaysWorked').value,
                extraDaysWorked: document.getElementById('extraDaysWorked').value,
                attendanceDays: document.getElementById('attendanceDays').value
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        function loadDataFromLocalStorage() {
            const storedData = localStorage.getItem(STORAGE_KEY);
            if (storedData) {
                const data = JSON.parse(storedData);
                
                // Restore global state
                otData = data.otData || {};
                currentMonth = data.currentMonth !== undefined ? data.currentMonth : new Date().getMonth();
                currentYear = data.currentYear !== undefined ? data.currentYear : new Date().getFullYear();
                
                // Restore input fields
                document.getElementById('sixthDaysWorked').value = data.sixthDaysWorked || 0;
                document.getElementById('extraDaysWorked').value = data.extraDaysWorked || 0;
                document.getElementById('attendanceDays').value = data.attendanceDays || 0;
            }
        }


        // --- TIME CONVERSION FUNCTIONS (H.MM -> H.D) ---

        /**
         * Converts time input (e.g., 5.45 for 5 hours 45 minutes) into decimal hours (5.75).
         */
        function timeToDecimalHours(time) {
            if (typeof time !== 'number' || isNaN(time) || time < 0) return 0;
            const hours = Math.floor(time);
            const minutesFractional = time - hours; 
            
            const minutes = Math.round(minutesFractional * 100); 
            const fractionalHours = minutes / 60;
            
            return hours + fractionalHours;
        }

        /**
         * Converts decimal hours (e.g., 5.75) back to time format (5.45) for display/editing.
         */
        function decimalHoursToTime(decimalHours) {
            const hours = Math.floor(decimalHours);
            const minutesDecimal = (decimalHours - hours) * 60; 
            
            const minutes = Math.round(minutesDecimal);
            
            const minutesStr = String(minutes).padStart(2, '0');
            
            return `${hours}.${minutesStr}`;
        }

        // --- PRESET FUNCTION ---
        function setPresetOT(type, value) {
            if (!selectedDate) {
                alert("Please select a date on the calendar first before setting a preset.");
                return;
            }
            
            const valueStr = value.toFixed(2); 

            if (type === 'normal') {
                document.getElementById('dailyNormalOt').value = valueStr;
            } else if (type === 'double') {
                document.getElementById('dailyDoubleOt').value = valueStr;
            }
            // Trigger save and update immediately after setting the preset
            saveDailyOT(); 
        }


        // --- CALENDAR/PAY PERIOD FUNCTIONS ---

        function getPayPeriod(displayMonth, displayYear) {
            const endMonthIndex = displayMonth;
            const endYear = displayYear;
            
            const startMonthIndex = (displayMonth - 1 + 12) % 12;
            const startYear = displayMonth === 0 ? displayYear - 1 : displayYear;

            const startDate = new Date(Date.UTC(startYear, startMonthIndex, 21));
            const endDate = new Date(Date.UTC(endYear, endMonthIndex, 20));

            return { startDate, endDate };
        }

        function updatePayPeriodDisplay(startDate, endDate) {
            const startStr = startDate.toLocaleDateString('en-US', { day: 'numeric', month: 'long', year: 'numeric' });
            const endStr = endDate.toLocaleDateString('en-US', { day: 'numeric', month: 'long', year: 'numeric' });
            document.getElementById('pay-period-display').textContent = `PAY PERIOD: ${startStr} to ${endStr}`;
        }

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            const monthYearDisplay = document.getElementById('current-month-year');
            
            const date = new Date(currentYear, currentMonth);
            
            monthYearDisplay.textContent = date.toLocaleString('en-US', { month: 'long', year: 'numeric' });
            grid.innerHTML = ''; 

            const { startDate, endDate } = getPayPeriod(currentMonth, currentYear);
            updatePayPeriodDisplay(startDate, endDate);

            const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            daysOfWeek.forEach(day => {
                grid.insertAdjacentHTML('beforeend', `<div class="day-name">${day}</div>`);
            });

            const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay();
            const lastDateOfMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

            for (let i = 0; i < firstDayOfMonth; i++) {
                grid.insertAdjacentHTML('beforeend', `<div class="day-cell"></div>`);
            }

            for (let day = 1; day <= lastDateOfMonth; day++) {
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                let cellClass = 'day-cell current-month';
                
                if (dateStr === selectedDate) {
                    cellClass += ' selected';
                }

                const dailyOT = otData[dateStr];
                let otIndicator = '';
                if (dailyOT && (dailyOT.normal > 0 || dailyOT.double > 0)) {
                    otIndicator = `<span class="ot-indicator">OT: ${dailyOT.normal.toFixed(2)} / ${dailyOT.double.toFixed(2)}</span>`;
                }

                grid.insertAdjacentHTML('beforeend', 
                    `<div class="${cellClass}" data-date="${dateStr}" onclick="selectDate('${dateStr}')">
                        ${day}
                        ${otIndicator}
                    </div>`
                );
            }
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            selectedDate = null; 
            renderCalendar();
            document.getElementById('ot-form-title').textContent = 'Enter OT for: Please Select a Date';
            document.getElementById('dailyNormalOt').value = '0.00';
            document.getElementById('dailyDoubleOt').value = '0.00';
            
            calculateSalary(); 
            saveDataToLocalStorage(); // Save changes to month/year
        }

        function selectDate(dateStr) {
            if (selectedDate) {
                const prevCell = document.querySelector(`.day-cell[data-date="${selectedDate}"]`);
                if (prevCell) prevCell.classList.remove('selected');
            }

            selectedDate = dateStr;
            const currentCell = document.querySelector(`.day-cell[data-date="${selectedDate}"]`);
            if (currentCell) currentCell.classList.add('selected');

            const dailyOT = otData[dateStr] || { normal: 0, double: 0 };
            
            document.getElementById('dailyNormalOt').value = decimalHoursToTime(dailyOT.normal);
            document.getElementById('dailyDoubleOt').value = decimalHoursToTime(dailyOT.double);

            const [year, month, day] = dateStr.split('-').map(Number);
            const dateObj = new Date(year, month - 1, day); 

            document.getElementById('ot-form-title').textContent = `Enter OT for: ${dateObj.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}`;
        }

        function saveDailyOT() {
            if (!selectedDate) {
                return;
            }

            const rawNormal = parseFloat(document.getElementById('dailyNormalOt').value) || 0;
            const rawDouble = parseFloat(document.getElementById('dailyDoubleOt').value) || 0;
            
            let normal = timeToDecimalHours(rawNormal);
            let double = timeToDecimalHours(rawDouble);
            
            otData[selectedDate] = { normal: normal, double: double };
            
            renderCalendar(); 
            calculateSalary();
            saveDataToLocalStorage(); // Save the updated OT data
        }

        // --- SALARY CALCULATION FUNCTIONS ---

        function calculateSalary() {
            let totalNormalOtHours = 0;
            let totalDoubleOtHours = 0;
            
            const { startDate, endDate } = getPayPeriod(currentMonth, currentYear);

            for (const dateStr in otData) {
                const [year, month, day] = dateStr.split('-').map(Number);
                const otDate = new Date(Date.UTC(year, month - 1, day));
                
                if (otDate >= startDate && otDate <= endDate) {
                    totalNormalOtHours += otData[dateStr].normal;
                    totalDoubleOtHours += otData[dateStr].double;
                }
            }

            const sixthDaysWorked = parseInt(document.getElementById('sixthDaysWorked').value) || 0;
            const extraDaysWorked = parseInt(document.getElementById('extraDaysWorked').value) || 0;
            const attendanceDays = parseInt(document.getElementById('attendanceDays').value) || 0;

            const normalOtPay = totalNormalOtHours * NORMAL_OT_RATE;
            const doubleOtPay = totalDoubleOtHours * DOUBLE_OT_RATE;
            const totalOtPay = normalOtPay + doubleOtPay;

            const sixthDayPay = sixthDaysWorked * SIXTH_DAY_BONUS;
            const extraDayPay = extraDaysWorked * EXTRA_DAY_RATE;
            const attendanceBonus = attendanceDays * ATTENDANCE_BONUS_RATE;
            const totalBonusPay = sixthDayPay + extraDayPay + attendanceBonus;

            const totalAllowances = totalOtPay + totalBonusPay;
            const grossSalary = BASIC_SALARY + totalAllowances;

            const otSummaryHtml = `
                <div class="result-detail"><strong>Total Normal OT Pay:</strong> <span>${normalOtPay.toFixed(2)} (${totalNormalOtHours.toFixed(2)} hrs)</span></div>
                <div class="result-detail"><strong>Total Double OT Pay:</strong> <span>${doubleOtPay.toFixed(2)} (${totalDoubleOtHours.toFixed(2)} hrs)</span></div>
                <div class="result-detail" style="border-top: 1px solid #ddd; margin-top: 5px;"><strong>TOTAL OVERTIME:</strong> <strong>${totalOtPay.toFixed(2)}</strong></div>
            `;
            document.getElementById('ot-summary').innerHTML = otSummaryHtml;

            const bonusSummaryHtml = `
                <div class="result-detail"><span>Sixth Day Pay (${sixthDaysWorked} days):</span> <span>${sixthDayPay.toFixed(2)}</span></div>
                <div class="result-detail"><span>Extra Day Pay (${extraDaysWorked} days):</span> <span>${extraDayPay.toFixed(2)}</span></div>
                <div class="result-detail"><span>Attendance Bonus (${attendanceDays} days):</span> <span>${attendanceBonus.toFixed(2)}</span></div>
                <div class="result-detail" style="border-top: 1px solid #ddd; margin-top: 5px;"><strong>TOTAL BONUSES:</strong> <strong>${totalBonusPay.toFixed(2)}</strong></div>
            `;
            document.getElementById('bonus-summary').innerHTML = bonusSummaryHtml;
            
            document.getElementById('details').innerHTML = `<div class="result-detail"><strong>TOTAL ALLOWANCES:</strong> <strong>${totalAllowances.toFixed(2)}</strong></div>`;
            document.getElementById('gross-salary').innerText = grossSalary.toFixed(2);
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            loadDataFromLocalStorage(); // Load data first
            
            // Set current month/year to loaded values, or today's date if no data was found
            const today = new Date();
            if (currentMonth === undefined) currentMonth = today.getMonth();
            if (currentYear === undefined) currentYear = today.getFullYear();
            
            renderCalendar();
            calculateSalary();
        });
    </script>
</body>
</html>
